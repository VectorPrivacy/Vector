<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Clicker</title>
    <script src="webxdc.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .player-info {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .score-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }
        
        .click-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(145deg, #ff6b6b, #ee5a5a);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.3),
                inset 0 -5px 20px rgba(0,0,0,0.2),
                inset 0 5px 20px rgba(255,255,255,0.2);
            cursor: pointer;
            font-size: 4rem;
            color: white;
            transition: transform 0.1s, box-shadow 0.1s;
            user-select: none;
        }
        
        .click-button:hover {
            transform: scale(1.05);
        }
        
        .click-button:active {
            transform: scale(0.95);
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 -2px 10px rgba(0,0,0,0.2),
                inset 0 2px 10px rgba(255,255,255,0.2);
        }
        
        .click-effect {
            position: fixed;
            pointer-events: none;
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            animation: floatUp 1s ease-out forwards;
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }
        
        .stats {
            margin-top: 30px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ® Vector Clicker</h1>
    <div class="player-info" id="playerInfo">Loading...</div>
    
    <div class="score-display" id="score">0</div>
    
    <button class="click-button" id="clickBtn" onclick="handleClick(event)">
        ðŸ‘†
    </button>
    
    <div class="stats" id="stats">
        Clicks per second: <span id="cps">0</span>
    </div>

    <script>
        // Game state
        let myScore = 0;
        let clickTimes = [];
        let myAddr = 'unknown';
        let myName = 'Player';
        
        // Initialize the game
        function init() {
            // Get player info from webxdc
            if (window.webxdc) {
                myAddr = window.webxdc.selfAddr || 'unknown';
                myName = window.webxdc.selfName || 'Player';
                
                document.getElementById('playerInfo').textContent = 
                    `Playing as: ${myName}`;
                
                // Set up update listener
                window.webxdc.setUpdateListener(function(update) {
                    handleUpdate(update);
                }, 0);
            } else {
                document.getElementById('playerInfo').textContent = 
                    'Demo mode (webxdc not available)';
            }
            
            // Update CPS every second
            setInterval(updateCPS, 1000);
        }
        
        // Handle click on the button
        function handleClick(event) {
            myScore++;
            updateScoreDisplay();
            createClickEffect(event);
            
            // Track click time for CPS calculation
            clickTimes.push(Date.now());
            
            // Send update to other players
            if (window.webxdc) {
                window.webxdc.sendUpdate({
                    payload: {
                        type: 'score',
                        addr: myAddr,
                        name: myName,
                        score: myScore
                    }
                }, `${myName} clicked! Score: ${myScore}`);
            }
        }
        
        // Handle updates from other players
        function handleUpdate(update) {
            if (update.payload && update.payload.type === 'score') {
                const { addr, name, score } = update.payload;
                
                // If it's our own update coming back, sync the score
                if (addr === myAddr && score > myScore) {
                    myScore = score;
                    updateScoreDisplay();
                }
            }
        }
        
        // Update the score display
        function updateScoreDisplay() {
            document.getElementById('score').textContent = myScore.toLocaleString();
        }
        
        // Create floating +1 effect
        function createClickEffect(event) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = '+1';
            effect.style.left = (event.clientX - 15) + 'px';
            effect.style.top = (event.clientY - 15) + 'px';
            document.body.appendChild(effect);
            
            setTimeout(() => effect.remove(), 1000);
        }
        
        // Calculate and display clicks per second
        function updateCPS() {
            const now = Date.now();
            const oneSecondAgo = now - 1000;
            
            // Filter to only clicks in the last second
            clickTimes = clickTimes.filter(t => t > oneSecondAgo);
            
            document.getElementById('cps').textContent = clickTimes.length;
        }
        
        // Start the game
        init();
    </script>
</body>
</html>